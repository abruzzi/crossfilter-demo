<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" content="">
        <title>TWer shapes</title>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap-theme.css" />

        <style type="text/css">
            .line {
              fill: none;
              stroke: #AC145A;
              stroke-width: 1px;
            }

            .axis line {
              stroke: #cccccc;
            }

            .axis path {
              fill: none;
              stroke: #dddddd;
            }

            .axis + .axis g text {
              display: none;
            }

            .tick {
              display: none;
            }

            .shape {
              fill: none;
              stroke: #AC145A;
              stroke-width: 1px;
            }

            .shape-baseline {
              fill: none;
              stroke: #AC145A;
              stroke-width: 1px;
              opacity: .1;
            }

            .title {
                fill: #333333;
            }
        </style>

    </head>
    <body>

        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-3 col-sm-3" id="twer-1"></div>
                <div class="col-lg-3 col-md-3 col-sm-3" id="twer-2"></div>
                <div class="col-lg-3 col-md-3 col-sm-3" id="twer-3"></div>
                <div class="col-lg-3 col-md-3 col-sm-3" id="twer-4"></div>
            </div>

            <div class="row">
                <div class="col-lg-3 col-md-3 col-sm-3" id="twer-5"></div>
                <div class="col-lg-3 col-md-3 col-sm-3" id="twer-6"></div>
                <div class="col-lg-3 col-md-3 col-sm-3" id="twer-7"></div>
                <div class="col-lg-3 col-md-3 col-sm-3" id="twer-8"></div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.8/d3.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.7.0/lodash.min.js"></script>
        <script src="https://d3js.org/d3-queue.v3.min.js"></script>
        <script src="scripts/shape-chart.js"></script>

        <script type="text/javascript">

        window.onload = function() {

            var chart = shapeChart();
            var categories = ["Technical", "Testing", "Consulting", "Domain", "BA & XD", "Management & Planning", "Language"];

            d3.json("data/name-mapping.json", function(mapping) {
                var ids = ["15356", "12399", "17608", "15812", "15683", "13710", "13970", "13906"];

                _.each(ids, function(value, index) {
                    d3.json("data/jigsaw.skills.for." + value + ".json", function(err, data) {
                        var grouped = _.groupBy(data.skills, 'group.name');

                        var  series = _.map(categories, function(category) {
                            var items = grouped[category];
                            if(items) {
                                return _.meanBy(items, function(x) {return x.rating;});              
                            } else {
                                return 0;
                            }
                        });

                        var series = _.concat(series, _.head(series));

                        var name = _.find(mapping, function(x) {return x.id === value})['name'];

                        chart.width(180).height(180).title(name);
                        d3.select("#twer-"+(index+1))
                          .datum(series)
                          .call(chart);
                    });    
                });
            });
            
        }
        </script>
    </body>
</html>